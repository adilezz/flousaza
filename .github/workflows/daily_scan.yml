name: Bourse Casa Daily Scan

on:
  schedule:
    # 15:00 UTC = 16:00 au Maroc (GMT+1)
    # Du Lundi (1) au Vendredi (5)
    - cron: '0 15 * * 1-5'
  workflow_dispatch: # Permet de lancer manuellement pour tester

permissions:
  contents: write # INDISPENSABLE : Donne le droit au bot d'Ã©crire dans le repo

jobs:
  run-analysis:
    runs-on: ubuntu-latest

    steps:
      # 1. RÃ©cupÃ©rer le code
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Installer Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          # On utilise 3.10 pour supporter le typage "int | None" et les derniÃ¨res fonctionnalitÃ©s
          python-version: '3.10'

      # 3. Installer les dÃ©pendances
      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      # 4. Lancer le script (avec les secrets)
      - name: Run Trading Bot
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: python BotBourse.py

      # 5. SAUVEGARDER LA MÃ‰MOIRE (Commit & Push DB)
      # C'est ici qu'on empÃªche la perte de l'historique
      - name: Commit and Push Database
        run: |
          git config --global user.name "GitHub Action Bot"
          git config --global user.email "actions@github.com"
          git add bourse_casa.db
          # On ne commit que s'il y a des changements (pour Ã©viter les erreurs)
          git commit -m "ðŸ“ˆ Mise Ã  jour automatique: Base de donnÃ©es historique" || exit 0
          git push